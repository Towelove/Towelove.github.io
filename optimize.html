<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>调优策略 | ToWeLove</title>
    <meta name="generator" content="VuePress 1.9.9">
    
    <meta name="description" content="双向的爱">
    
    <link rel="preload" href="/assets/css/0.styles.e8e4f3a3.css" as="style"><link rel="preload" href="/assets/js/app.dbd4a1a6.js" as="script"><link rel="preload" href="/assets/js/4.483b6d7b.js" as="script"><link rel="preload" href="/assets/js/12.60aed2d8.js" as="script"><link rel="prefetch" href="/assets/js/10.52b9bfaf.js"><link rel="prefetch" href="/assets/js/11.795b5ff3.js"><link rel="prefetch" href="/assets/js/13.bbc5a988.js"><link rel="prefetch" href="/assets/js/14.396675e5.js"><link rel="prefetch" href="/assets/js/15.cbe65830.js"><link rel="prefetch" href="/assets/js/16.b61c0a46.js"><link rel="prefetch" href="/assets/js/17.cb01e9bb.js"><link rel="prefetch" href="/assets/js/2.ff14e80a.js"><link rel="prefetch" href="/assets/js/3.92e47562.js"><link rel="prefetch" href="/assets/js/5.c787d731.js"><link rel="prefetch" href="/assets/js/6.6d659c0c.js"><link rel="prefetch" href="/assets/js/7.44e656f5.js"><link rel="prefetch" href="/assets/js/8.fa2b5d17.js"><link rel="prefetch" href="/assets/js/9.3f930ac2.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e8e4f3a3.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">ToWeLove</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://blog.csdn.net/Zhangsama1?type=bbs" target="_blank" rel="noopener noreferrer" class="nav-link external">
  CSDN
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/Towelove" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://space.bilibili.com/141176332" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Bilibili
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://blog.csdn.net/Zhangsama1?type=bbs" target="_blank" rel="noopener noreferrer" class="nav-link external">
  CSDN
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/Towelove" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://space.bilibili.com/141176332" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Bilibili
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/prd.html" class="sidebar-link">产品文档</a></li><li><a href="/origin.html" class="sidebar-link">梦开始的地方</a></li><li><a href="/introduce.html" class="sidebar-link">项目介绍</a></li><li><a href="/techstack.html" class="sidebar-link">项目技术栈及版本</a></li><li><a href="/tips.html" class="sidebar-link">技术Tips</a></li><li><a href="/devtools.html" class="sidebar-link">项目开发工具</a></li><li><a href="/p&amp;s.html" class="sidebar-link">遇到的问题及解决办法</a></li><li><a href="/optimize.html" aria-current="page" class="active sidebar-link">调优策略</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/optimize.html#redis缓存" class="sidebar-link">Redis缓存</a></li><li class="sidebar-sub-header"><a href="/optimize.html#请求路径的封装" class="sidebar-link">请求路径的封装</a></li><li class="sidebar-sub-header"><a href="/optimize.html#多线程发送任务" class="sidebar-link">多线程发送任务</a></li><li class="sidebar-sub-header"><a href="/optimize.html#任务的封装" class="sidebar-link">任务的封装</a></li><li class="sidebar-sub-header"><a href="/optimize.html#线程池动态调优" class="sidebar-link">线程池动态调优</a></li><li class="sidebar-sub-header"><a href="/optimize.html#任务获取数量调优" class="sidebar-link">任务获取数量调优</a></li><li class="sidebar-sub-header"><a href="/optimize.html#异步任务" class="sidebar-link">异步任务</a></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="调优策略"><a href="#调优策略" class="header-anchor">#</a> 调优策略</h1> <h2 id="redis缓存"><a href="#redis缓存" class="header-anchor">#</a> Redis缓存</h2> <p>为了提高项目的访问速度，使用缓存是很正常的，可以减少请求打到MySQL中，在提高响应速度的同时减少了数据库的压力，但是使用Redis缓存将需要面临如下三个问题，下面三个小章节介绍了我们是如何解决这三个问题的。</p> <h3 id="可用方案"><a href="#可用方案" class="header-anchor">#</a> 可用方案：</h3> <h3 id="springcache集成redis"><a href="#springcache集成redis" class="header-anchor">#</a> SpringCache集成Redis</h3> <h3 id="rediscache"><a href="#rediscache" class="header-anchor">#</a> RedisCache</h3> <h3 id="缓存穿透"><a href="#缓存穿透" class="header-anchor">#</a> 缓存穿透</h3> <h3 id="缓存并发"><a href="#缓存并发" class="header-anchor">#</a> 缓存并发</h3> <h3 id="缓存失效"><a href="#缓存失效" class="header-anchor">#</a> 缓存失效</h3> <h3 id="与mysql的数据一致性问题"><a href="#与mysql的数据一致性问题" class="header-anchor">#</a> 与MySQL的数据一致性问题</h3> <p><a href="https://javaguide.cn/database/redis/3-commonly-used-cache-read-and-write-strategies.html" target="_blank" rel="noopener noreferrer">[三种缓存的读写策略]<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://www.iocoder.cn/Fight/How-Redis-and-MySQL-double-write-consistency-guarantee/?yudao" target="_blank" rel="noopener noreferrer">[Redis和MySQL双写一致性如何保证]<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://mp.weixin.qq.com/s?__biz=MzIyOTYxNDI5OA==&amp;mid=2247487312&amp;idx=1&amp;sn=fa19566f5729d6598155b5c676eee62d&amp;chksm=e8beb8e5dfc931f3e35655da9da0b61c79f2843101c130cf38996446975014f958a6481aacf1&amp;scene=178&amp;cur_album_id=1699766580538032128#rd" target="_blank" rel="noopener noreferrer">[缓存和数据库一致性问题详细版]<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="实际使用方式"><a href="#实际使用方式" class="header-anchor">#</a> 实际使用方式</h3> <h2 id="请求路径的封装"><a href="#请求路径的封装" class="header-anchor">#</a> 请求路径的封装</h2> <p>我们的项目使用的是RESTFul风格来发送请求，那么这就意味着有编程基础的人，以及对项目有恶意的人可以很容易的了解我们项目的路径设置规则，一次为了防止这种恶意攻击，我们对真正展示在浏览器地址栏的路径进行了封装</p> <p>比如原本的一个请求路径：http://123.123.123.123:8080/user/get可能就会变成如下一个请求</p> <p>http://123.123.123.123:8080/lasd123/a123</p> <h2 id="多线程发送任务"><a href="#多线程发送任务" class="header-anchor">#</a> 多线程发送任务</h2> <p>我们知道我们的项目中的消息的任务是有时间的，因此我们可以按照时间对任务进行排序，并且使用多线程去发送这些任务。那么可以考虑允许多线程写读的ConcurrentLinkedQueue，既保证了FIFO，并且可以保证多线程下的线程安全策略。</p> <h2 id="任务的封装"><a href="#任务的封装" class="header-anchor">#</a> 任务的封装</h2> <p>任务可以使用Future陪着Semaphore来实现所有任务同时完成后的应答，同时Future在任务完成后是有返回值的，我们就知道那些任务是失败了的，就可以进行失败重试。</p> <p><img src="https://www.notion.so/image/https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2023%2Fpng%2F34806522%2F1678779397411-26d86cc7-67e4-400f-ab54-23c01a353de8.png?id=044d5fef-dfe8-4f17-9742-9b60875f784b&amp;table=block&amp;spaceId=b64c4d64-f403-4087-86e0-a1e8fdb8361f&amp;width=2000&amp;userId=c25e5a34-6e8a-4a43-ba9f-f420d2f8d2b7&amp;cache=v2" alt="https://cdn.nlark.com/yuque/0/2023/png/34806522/1678779397411-26d86cc7-67e4-400f-ab54-23c01a353de8.png"></p> <h2 id="线程池动态调优"><a href="#线程池动态调优" class="header-anchor">#</a> 线程池动态调优</h2> <p><a href="https://tech.meituan.com/2020/04/02/java-pooling-pratice-in-meituan.html" target="_blank" rel="noopener noreferrer">线程池线程数量动态调优<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>在我们买的面试题里面有对线程池的动态调优方法</p> <h2 id="任务获取数量调优"><a href="#任务获取数量调优" class="header-anchor">#</a> 任务获取数量调优</h2> <p>忽然想到 我们的每次查询出来的任务数量应该是动态可变的 也就是先select count 然后分片</p> <p>得考虑如何做到动态sql</p> <p>因为如果说任务很多 在某一个时间段就会查询出来特别多的任务 有点危</p> <h2 id="异步任务"><a href="#异步任务" class="header-anchor">#</a> 异步任务</h2> <p>异步任务就是为了解耦来做的，当一个线程的执行结果不依赖之前的执行结果的时候，为了提高性能，我们就可以使用异步任务来完成接下来的任务，比如日志的记录等。</p> <p><a href="https://www.iocoder.cn/Spring-Boot/Async-Job/" target="_blank" rel="noopener noreferrer">SpringBoot异步任务入门<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>其中需要注意的一点是，对于全局异步任务异常处理器。</p> <div class="language- extra-class"><pre class="language-text"><code>* 只能拦截返回类型非 Future 的异步调用方法。
* 查看AsyncExecutionAspectSupport#handleError(Throwable ex, Method method, Object... params)
* 的源码，可以很容易得到这个结论
* 所以返回类型为 Future 的异步调用方法，
* 需要通过 [异步回调] 来处理。也就是设定addCallBack()方法来处理
* 并且这个方法只能对直接拥有@Async的方法扔出的报错能进行处理
* 而再方法中调用了包含@Async的方法是不能的
</code></pre></div><p>这里我解释一下最后两行是什么意思，也就是，虽然我在测试中调用了testAsyncWithCallBack方法，并且这个方法调用了一个异步方法，但是这个异步方法发出的错误并不会被全局异步任务处理器给处理，我们必须直接调用包含了@Async注解的方法，其报错才会被全局异步任务处理器所处理。</p> <p><img src="https://www.notion.so/image/https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2023%2Fpng%2F34806522%2F1679631291313-f51c4a07-a017-430c-aa44-3c97f756c3a0.png?id=2440b21e-3fd7-4c3b-b5f9-da706a16e68b&amp;table=block&amp;spaceId=b64c4d64-f403-4087-86e0-a1e8fdb8361f&amp;width=2000&amp;userId=c25e5a34-6e8a-4a43-ba9f-f420d2f8d2b7&amp;cache=v2" alt="https://cdn.nlark.com/yuque/0/2023/png/34806522/1679631291313-f51c4a07-a017-430c-aa44-3c97f756c3a0.png"></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/p&amp;s.html" class="prev">
        遇到的问题及解决办法
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.dbd4a1a6.js" defer></script><script src="/assets/js/4.483b6d7b.js" defer></script><script src="/assets/js/12.60aed2d8.js" defer></script>
  </body>
</html>
